colorscheme base16_default

set global tabstop 2
set global aligntab false
set global indentwidth 0
set global scrolloff 3,5
set global incsearch true
hook global WinDisplay .* %{ addhl wrap } # softwrap

map global normal <a-m> :make
map global normal <a-n> :make-next-error<ret>
map global normal <a-p> :make-previous-error<ret>
map global normal <a-N> :lint-next<ret><ret>

set global modelinefmt '{red}%val{bufname}{default} %opt{filetype} %val{cursor_line}:%val{cursor_char_column} {{context_info}} {{mode_info}} - %val{client}@[%val{session}]'

hook global WinSetOption filetype=(vbs|batch) %{
	set buffer indentwidth 1
}

hook global WinSetOption filetype=(?!vbs|batch).* %{
    hook global InsertChar \t %{
      exec -draft -itersel h@
    }
}

hook global WinSetOption filetype=(?!makefile).* %{
    set buffer indentwidth 2
}

hook global NormalKey [/?*nN]|<a-[/?*nN]> %{ try %{
  add-highlighter dynregex '%reg{/}' 0:search
}}

hook global NormalKey <esc> %{ try %{
  remove-highlighter dynregex_%reg{<slash>}
}}

set global ignored_files '.*\.exe|.*\.dll|.*\.o|.*\.pyc|.*\~|^\#.*\#|.*\.obj|\.git'

hook global WinCreate .* %{
    addhl show_matching
    addhl number_lines
}

map global normal '#' :comment-line<ret>
map global normal '<a-#>' :comment-block<ret>

map global normal   <c-w>   :tmux-new-horizontal<ret>
map global normal   <c-e>   :tmux-new-vertical<ret>
map -docstring 'Search word in `man <word>`' global user k :man<ret> 
# #
# ^
# -
# _
# =
# +
map global normal <a-c> :gdb-advance<ret>

map global user P '!xsel --output --clipboard<ret>' -docstring 'Paste before'
map global user p '<a-!>xsel --output --clipboard<ret>' -docstring 'Paste after'

def ide %{
    rename-client main
    set global jumpclient main

    tmux-new-horizontal rename-client docs
    set global docsclient docs

    tmux-new-vertical rename-client tools
    set global toolsclient tools

    %sh{tmux select-pane -t :.+}

    gdb-enable-autojump
}

set global ui_options ncurses_assistant=dilbert

hook global WinSetOption filetype=c %{
    %sh{
        switches="-Werror -Wextra -Wall -Wno-unused-parameter -Wno-missing-field-initializers"
        if [[ $PWD =~ /home/kotto/dev/c/ ]]; then
           switches="$switches -std=c11"
          if [[ $PWD =~ /home/kotto/dev/c/gui-playground/ ]]; then
              switches="$switches -I/usr/include/freetype2"
          elif [[ $PWD =~ /home/kotto/dev/c/atmega ]]; then
             switches="$switches"
          elif [[ $PWD =~ /home/kotto/dev/c/cgi ]]; then
             switches="$switches -I/usr/include/ClearSilver"
         fi
        switches="$switches -I/usr/include/ClearSilver"
        switches="$switches -I/usr/include/freetype2"
       fi
       if [[ $PWD =~ /home/kotto/dev/arm/stm/f1 ]]; then
         switches="$switches -std=c11 -I/home/kotto/dev/arm/stm/f1/stm32/device/"
       elif [[ $PWD =~ /home/kotto/dev/arm/stm/f4 ]]; then
         switches="$switches -std=c11 -I/home/kotto/dev/arm/stm/f4/stm32/device/"
       fi
       printf "echo -debug hi \'$switches\'\n"
       printf "set buffer clang_options '%s'\n" "$switches"
    }
}
hook global WinSetOption filetype=(c|cpp) %{
    clang-enable-autocomplete 
    clang-enable-diagnostics
    set buffer tabstop 2
    alias window lint clang-parse
    alias window lint-next clang-diagnostics-next
    hook global BufWritePost .* lint
}

hook global WinSetOption filetype=python %{
    jedi-enable-autocomplete
    flake8-enable-diagnostics
    alias window lint flake8-lint
    alias window lint-next flake8-diagnostics-next
    %sh{
        if [ $PWD = "/home/mawww/prj/kakoune/src" ]; then
           echo "set buffer jedi_python_path '/usr/share/gdb/python'"
           echo "set buffer path './:/usr/share/gdb/python'"
        fi
    }
}

hook global WinSetOption filetype=(asciidoc) %{
    hook buffer BufWritePost .* %{
        %sh{asciidoctor $kak_buffile}
    }
}

hook global BufCreate (.*/)?PKGBUILD %{
    set buffer filetype sh
}

hook global WinSetOption filetype=pascal %{
    map buffer object c :begin,end<ret> -docstring 'Pascal/Delphi begin/end block'
    lint-enable
}

hook global WinSetOption filetype=ada %{
    map buffer object c :begin,end<ret> -docstring 'Ada begin/end block'
}

hook global WinSetOption filetype=(batch|vbs|vb) %{
    set buffer eolformat crlf
}
